# Fully Automated Jenkins

FAJ – это репозиторий, предназначенный для автоматического развертывания предварительно настроенного Jenkins, с помощью такого инструмента автоматизации, как Ansible. Концепт предварительно настроенного Jenkins достигается за счет таких двух инструментов, как Docker (для запуска самого Jenkins с необходимыми системными параметрами) и плагин CasC (для описания конфигурации Jenkins в виде кода). Помимо этого, средствами всё того же Ansible, опционально, можно осуществить мануальную установку Jenkins, развернуть Jenkins Agent на сторонних узлах, а также настроить Nginx + SSL, для проксирования запросов, и т.д.

## Мотивация:

Мотивацией послужила задача из частного случая, когда у нас есть N-ое количество окружений, и под каждое окружение выделяется отдельный Jenkins, для последующей работы с этим самым окружением. Следовательно, такой Jenkins необходимо подготовить, со всеми его заданиями, учетными данными, пользователями, настройками Github и Gitlab, и т.д. С ростом числа окружений возрастает и число Jenkins, которые будут задействованы. Исходя из этого возникает как желание, так и потребность в том, чтобы такой Jenkins уже обладал хотя бы базовыми настройками, применимыми во всех случаях. Именно это и пытается решить данный проект.

## Предустановка:

Для успешного запуска необходимо установить минимальное количество программных коммпонентов. В частности, это:

- Git на сервере, с помощью которого вами будет загружен репозиторий из Github.

- Docker и Docker-compose на сервере, средствами которых осуществялется классическое (в представлении этого репозитория) развертывание Jenkins в системе.

- Ansible на вашем клиентском узле, если собираетесь развертывать Jenkins на двух или более серверах с разными ОС.

- Пользователь с правами sudo на серверах, из под которого будут запускаться плейбуки на каждом из серверов.

## Структура репозитория:

По умолчанию, если вы попытаетесь развернуть Jenkins с помощью данного репозитория, то процесс установки и запуска будет успешно завершен (исключением является изменение работы самого Jenkins). Однако, если вы хотите изменить вводные данные, такие, например, как плагины с их версиями или учетные данные пользователя, то в таком случае понадобятся изменения содержимого в файлах. Ниже представлено краткое описание того, что собой представляет каждый из файлов в корне репозитория:

- Dockerfile: Файл для сборки индивидуального образа, который используется для запуска Jenkins, с помощью docker-compose.

- jenkins-docker-compose.yaml: Файл для непосредственного запуска Jenkins на базе образа, полученного с помощью Dockerfile.

- plugins.txt: Файл, содержащий список плагинов, которые будут установлены в Jenkins во время его сборки. Для некоторых плагинов указана конкретная версия, так как не редко бывает, что обновление плагина ломает как некоторую функциональность, так и Jenkins в целом. Впрочем, жесткая привязка версии плагина является опциональным действием.

- .env: Файл, содержащий список переменных, которые прописаны в конфигурационных файлах для плагина CasC. В общей сложности здесь отмечены самые часто изменяемые параметры в Jenkins. Например такие, как данные пользователя, общие настройки и т.д.

- jcasc: Директория с конфигурационными файлами, которые используются для описания Jenkins в виде кода. В них же, вместо жесткой привязки какого-либо значения, указана переменная, ссылающаяся на файл .env.

- ansible: Директория, которая целиком и полностью предназначена для развертывания Jenkins с помощью такого инструмента автоматизации, как Ansible.

## Классическое развертывание Jenkins:

Классическое развертывание подразумевает под собой запуск Jenkins без участия Ansible в цепочке. Это на тот случай, если кто-то с ним не знаком, не хочет его использовать и т.д. Концепция применения остается неизменной, что при наличии, что при отсутствии Ansible. После того как проект был склонирован, необходимо перейти в директорию и запустить docker-compose, чтобы начался процесс сборки и запуска Jenkins. Выглядеть это будет следующим образом:

```
docker-compose -f jenkins-docker-compose.yaml up -d
```

Примечание: По умолчанию в файле jenkins-docker-compose.yaml указано, что Jenkins будет запущен с адресом 127.0.0.1:8080, что означает, что он будет доступен только для того инстанса, на котором был запущен. Сделано это было так потому, чтобы до Jenkins нельзя было достучаться из вне, так как подразумевается, что между ним и клиентом ещё будет присутствовать Nginx, который спроксирует поступающие запросы. Если вы хотите, чтобы Jenkins был доступен для всего мира, необходимо в файле jenkins-docker-compose.yaml изменить 127.0.0.1 на 0.0.0.0.

После того как Jenkins был успешно запущен, можно обратиться к его панели, введя в адресной строке публичный IP-адрес или домен (учитывая изменения, указанные в примечании выше). Вместо привычной инициализации нас сразу просят ввести пользователя и пароль. Ниже представлены учетные данные для входа по умолчанию:

```
Login: admin
Password: Kitezh1165
```

Однако, значения параметров можно изменить, если перед запуском поменять содержимое следующих двух переменных в файле .env:

```
JCASC_JENKINS_ADMIN_USER="admin"
JCASC_JENKINS_ADMIN_PASSWORD="Kitezh1165"
```


