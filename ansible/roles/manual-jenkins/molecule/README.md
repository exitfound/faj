## **Molecule:**

Данная секция предназначена для запуска и выполнения тестов с помощью такого инструмента, как Molecule. Этот инструмент осуществляет предварительный запуск ролей на указанных платформах (Docker, Cloud и т.д.). Делается это для того, чтобы когда роль была написана или изменена, не приходилось выполнять её запуск непосредственно на реальных серверах, так это может привести к непредвиденным обстоятельствам.

### **Установка molecule:**

Для того чтобы установить `molecule` локально со всеми зависимостями, выполните следующую команду в корне проекта:

```
pip3 install -r requirements.txt
```

### **Запуск тестов в Docker:**

Тесты по отношению к данной роли могут быть выполнены на базе таких платформ, как Docker и AWS EC2. Чтобы запустить полный прогон, необходимо выполнить команду, указав путь к тому или иному виду теста. Так, например, чтобы запустить тесты в среде Docker, укажите желаемое семейство дистрибутивов, для которого хотите прогнать роль:

```
molecule test -s [docker-debian, docker-ubuntu, docker-suse, docker-redhat] # Укажите на выбор одно из семейств дистрибутивов Linux;
```

В данном случае в каждой из директорий с именем `docker-*` указан примерно один и тот же набор параметров для запуска тестов. Отличаются только образы в зависимости от используемого семейства. Сами тесты были разбиты на условные секции по той простой причине, что для запуска всех образов за раз необходимо немалое число ресурсов, что в свою очередь может быть недоступно на вашем устройстве. Потому что для запуска Jenkins необходимо по меньшей мере 2 ГБ памяти и так для каждого экземпляра. Учитывая общее число возможных версий дистрибутивов, это чревато последствиями. К тому же по такому распределению проще было интегрировать процесс CI.

### **Запуск тестов в AWS:**

Принцип запуска тестов в AWS абсолютно идентичен примеру с Docker, за тем исключением, что контекстный путь отличается. Вот пример запуска тестов для AWS:

```
molecule test -s [aws-debian, aws-ubuntu, aws-suse, aws-redhat] # Укажите на выбор одно из семейств дистрибутивов Linux;
```

### **Прочие команды:**

Если вы хотите запустить прогон тестов без проверки идемпотентности, то для этого выполните следующую команду на выбор в зависимости от вашей платформы:

```
molecule converge -s [docker-debian, docker-ubuntu, docker-suse, docker-redhat] # Укажите на выбор одно из семейств дистрибутивов Linux;
molecule converge -s [aws-debian, aws-ubuntu, aws-suse, aws-redhat] # Укажите на выбор одно из семейств дистрибутивов Linux;
```

Чтобы явно уничтожить следы деятельности прогона тестов используйте следующую команду:

```
molecule destroy -s [docker-debian, docker-ubuntu, docker-suse, docker-redhat] # Укажите на выбор одно из семейств дистрибутивов Linux;
molecule destroy -s [aws-debian, aws-ubuntu, aws-suse, aws-redhat] # Укажите на выбор одно из семейств дистрибутивов Linux;
```

Это может быть полезно в некоторых случаях, так как не всегда прогон тестов завершается успешно и иногда кэш или какие-либо другие следы предыдущего запуска могут помешать следующему. Особенно такое поведение можно наблюдать при работе с Docker.
